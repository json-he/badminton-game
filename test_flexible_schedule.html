<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµæ´»èµ›ç¨‹ç”Ÿæˆå™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .controls {
            margin: 10px 0;
        }
        .controls label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        .controls select, .controls input {
            padding: 5px 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .match-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .match-item {
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .player-stat {
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ çµæ´»èµ›ç¨‹ç”Ÿæˆå™¨æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æµ‹è¯•é…ç½®</h3>
            <div class="controls">
                <label>ç©å®¶æ•°é‡:</label>
                <select id="playerCount">
                    <option value="5">5äºº</option>
                    <option value="6" selected>6äºº</option>
                    <option value="7">7äºº</option>
                    <option value="8">8äºº</option>
                </select>
            </div>
            <div class="controls">
                <label>æœ€å¤§è¿ç»­æ¯”èµ›:</label>
                <select id="maxConsecutive">
                    <option value="1">1åœº (æœ€ä¸¥æ ¼)</option>
                    <option value="2" selected>2åœº (æ¨è)</option>
                    <option value="3">3åœº (å®½æ¾)</option>
                </select>
            </div>
            <div class="controls">
                <label>æœ€å¤§è¿ç»­ä¼‘æ¯:</label>
                <select id="maxRest">
                    <option value="2">2åœº</option>
                    <option value="3">3åœº</option>
                    <option value="4" selected>4åœº (æ¨è)</option>
                    <option value="5">5åœº</option>
                </select>
            </div>
            <div class="controls">
                <label>
                    <input type="checkbox" id="preferEven" checked>
                    ä¼˜å…ˆå‡åŒ€åˆ†å¸ƒ
                </label>
            </div>
            <button onclick="runTest()">ğŸš€ è¿è¡Œæµ‹è¯•</button>
            <button onclick="runMultipleTests()">ğŸ”„ æ‰¹é‡æµ‹è¯• (10æ¬¡)</button>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="results" class="results">ç‚¹å‡»"è¿è¡Œæµ‹è¯•"å¼€å§‹...</div>
        </div>
    </div>

    <script src="flexible_schedule.js"></script>
    <script>
        function generateTestPlayers(count) {
            const names = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å'];
            return names.slice(0, count);
        }
        
        function runTest() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const maxConsecutive = parseInt(document.getElementById('maxConsecutive').value);
            const maxRest = parseInt(document.getElementById('maxRest').value);
            const preferEven = document.getElementById('preferEven').checked;
            
            const players = generateTestPlayers(playerCount);
            const options = {
                maxConsecutiveMatches: maxConsecutive,
                maxConsecutiveRests: maxRest,
                preferEvenDistribution: preferEven,
                allowFlexibleRest: true,
                maxAttempts: 1000
            };
            
            console.log('ğŸ¯ å¼€å§‹æµ‹è¯•:', { playerCount, options });
            
            const startTime = Date.now();
            const generator = new FlexibleScheduleGenerator(options);
            const matches = generator.generateSchedule(players);
            const endTime = Date.now();
            
            displayResults(matches, players, options, endTime - startTime);
        }
        
        function runMultipleTests() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const maxConsecutive = parseInt(document.getElementById('maxConsecutive').value);
            const maxRest = parseInt(document.getElementById('maxRest').value);
            const preferEven = document.getElementById('preferEven').checked;
            
            const players = generateTestPlayers(playerCount);
            const options = {
                maxConsecutiveMatches: maxConsecutive,
                maxConsecutiveRests: maxRest,
                preferEvenDistribution: preferEven,
                allowFlexibleRest: true,
                maxAttempts: 1000
            };
            
            console.log('ğŸ”„ å¼€å§‹æ‰¹é‡æµ‹è¯•:', { playerCount, options });
            
            const results = [];
            const startTime = Date.now();
            
            for (let i = 0; i < 10; i++) {
                const generator = new FlexibleScheduleGenerator(options);
                const matches = generator.generateSchedule(players);
                results.push(matches);
            }
            
            const endTime = Date.now();
            
            displayBatchResults(results, players, options, endTime - startTime);
        }
        
        function displayResults(matches, players, options, duration) {
            const resultsDiv = document.getElementById('results');
            
            if (!matches || matches.length === 0) {
                resultsDiv.innerHTML = '<span class="error">âŒ æ— æ³•ç”Ÿæˆæ»¡è¶³æ¡ä»¶çš„èµ›ç¨‹</span>';
                return;
            }
            
            let html = `<h4>âœ… æµ‹è¯•æˆåŠŸå®Œæˆ (è€—æ—¶: ${duration}ms)</h4>`;
            html += `<p><strong>é…ç½®:</strong> ${players.length}äºº, æœ€å¤§è¿ç»­${options.maxConsecutiveMatches}åœº, æœ€å¤§ä¼‘æ¯${options.maxConsecutiveRests}åœº</p>`;
            html += `<p><strong>ç”Ÿæˆåœºæ¬¡:</strong> ${matches.length}åœº</p>`;
            
            // æ˜¾ç¤ºæ¯”èµ›åˆ—è¡¨
            html += '<h5>ğŸ“‹ æ¯”èµ›å®‰æ’:</h5>';
            html += '<div class="match-list">';
            matches.forEach((match, index) => {
                html += `
                    <div class="match-item">
                        <strong>ç¬¬${index + 1}åœº:</strong><br>
                        ${match.team1.join(' + ')} VS ${match.team2.join(' + ')}
                    </div>
                `;
            });
            html += '</div>';
            
            // åˆ†æç©å®¶ç»Ÿè®¡
            const playerStats = analyzePlayerStats(matches, players);
            html += '<h5>ğŸ“Š ç©å®¶ç»Ÿè®¡:</h5>';
            html += '<div class="player-stats">';
            
            playerStats.forEach((stats, index) => {
                const playerName = players[index];
                let statusClass = 'success';
                let statusIcon = 'âœ…';
                
                if (stats.consecutiveIssues > 0) {
                    statusClass = 'warning';
                    statusIcon = 'âš ï¸';
                }
                
                html += `
                    <div class="player-stat">
                        <strong>${statusIcon} ${playerName}</strong><br>
                        æ€»åœºæ¬¡: ${stats.matchCount}<br>
                        è¿ç»­é—®é¢˜: ${stats.consecutiveIssues}ä¸ª<br>
                        æœ€é•¿è¿ç»­: ${stats.maxConsecutive}åœº<br>
                        æ¯”èµ›åœºæ¬¡: ${stats.matches.join(', ')}
                    </div>
                `;
            });
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        }
        
        function displayBatchResults(results, players, options, duration) {
            const resultsDiv = document.getElementById('results');
            
            let html = `<h4>ğŸ”„ æ‰¹é‡æµ‹è¯•å®Œæˆ (è€—æ—¶: ${duration}ms)</h4>`;
            html += `<p><strong>é…ç½®:</strong> ${players.length}äºº, æœ€å¤§è¿ç»­${options.maxConsecutiveMatches}åœº, æœ€å¤§ä¼‘æ¯${options.maxConsecutiveRests}åœº</p>`;
            html += `<p><strong>æµ‹è¯•æ¬¡æ•°:</strong> ${results.length}æ¬¡</p>`;
            
            let successCount = 0;
            let totalConsecutiveIssues = 0;
            let totalDuration = 0;
            
            results.forEach((matches, index) => {
                if (matches && matches.length > 0) {
                    successCount++;
                    const playerStats = analyzePlayerStats(matches, players);
                    const consecutiveIssues = playerStats.reduce((sum, stats) => sum + stats.consecutiveIssues, 0);
                    totalConsecutiveIssues += consecutiveIssues;
                }
            });
            
            html += `<p><strong>æˆåŠŸç‡:</strong> ${successCount}/${results.length} (${(successCount/results.length*100).toFixed(1)}%)</p>`;
            html += `<p><strong>å¹³å‡è¿ç»­é—®é¢˜:</strong> ${(totalConsecutiveIssues/successCount).toFixed(1)}ä¸ª/æ¬¡</p>`;
            
            if (successCount > 0) {
                html += '<p class="success">âœ… ç®—æ³•è¡¨ç°è‰¯å¥½ï¼Œèƒ½å¤Ÿç¨³å®šç”Ÿæˆæ»¡è¶³æ¡ä»¶çš„èµ›ç¨‹</p>';
            } else {
                html += '<p class="error">âŒ ç®—æ³•éœ€è¦è°ƒæ•´ï¼Œæ— æ³•ç”Ÿæˆæ»¡è¶³æ¡ä»¶çš„èµ›ç¨‹</p>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function analyzePlayerStats(matches, players) {
            const playerStats = players.map(() => ({
                matchCount: 0,
                matches: [],
                consecutiveIssues: 0,
                maxConsecutive: 0
            }));
            
            // ç»Ÿè®¡æ¯ä¸ªç©å®¶çš„æ¯”èµ›æƒ…å†µ
            matches.forEach((match, matchIndex) => {
                const playingPlayers = [...match.team1, ...match.team2];
                playingPlayers.forEach(playerName => {
                    const playerIndex = players.indexOf(playerName);
                    if (playerIndex !== -1) {
                        playerStats[playerIndex].matchCount++;
                        playerStats[playerIndex].matches.push(matchIndex + 1);
                    }
                });
            });
            
            // åˆ†æè¿ç»­æ¯”èµ›é—®é¢˜
            playerStats.forEach((stats, playerIndex) => {
                let currentConsecutive = 1;
                let maxConsecutive = 1;
                
                for (let i = 1; i < stats.matches.length; i++) {
                    if (stats.matches[i] === stats.matches[i-1] + 1) {
                        currentConsecutive++;
                        maxConsecutive = Math.max(maxConsecutive, currentConsecutive);
                    } else {
                        if (currentConsecutive > 2) {
                            stats.consecutiveIssues++;
                        }
                        currentConsecutive = 1;
                    }
                }
                
                if (currentConsecutive > 2) {
                    stats.consecutiveIssues++;
                }
                
                stats.maxConsecutive = maxConsecutive;
            });
            
            return playerStats;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œä¸€æ¬¡æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runTest, 500);
        });
    </script>
</body>
</html>
